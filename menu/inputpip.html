<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Daftar PIP</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Arial, sans-serif;
  background:#f2f4f7;
  margin:0;
  padding:0px;
}
#tabelAset tr td{border-bottom:1px solid #b5b5b5}
#tabelAset tr th{border-bottom:2px solid #b5b5b5}

.lazy-img{
  width:80px;
  object-fit:cover;
  background:#f2f2f2;
}

#img1{width:50px}
#m_foto{width:150px}
.box{
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:5px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
  overflow-x:scroll;
}

 @media all and (min-width: 768px) {
 .box{
  max-width:900px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
  overflow-x:scroll;
}
 }



h2{margin-top:0}
select{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  font-size:16px;
}
.info{
  font-size:14px;
  color:#555;
  margin-bottom:10px;
}
ul{
  list-style:none;
  padding:0;
  margin:0;
}
li{
  padding:10px;
  border-bottom:1px solid #eee;
}
li:last-child{border-bottom:none}
.loading{
  text-align:center;
  color:#777;
}
</style>
<style>
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  z-index:999;
  overflow:scroll;
}
.modal-content{
  background:#fff;
  max-width:400px;
  margin:auto;
  padding:20px;
  border-radius:10px;
  animation:fade .2s;
  
}
.close{
  float:right;
  font-size:22px;
  cursor:pointer;
}
tr{
  cursor:pointer;
}
@keyframes fade{
  from{transform:scale(.9);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
<style>
   
   /*video {
  -webkit-transform: scaleX(-1);
  transform: scaleX(-1);
}*/
   
#cs,#css{display:none;border:1px solid black;border-radius:5px;padding:5px}
  
#tdw{display:none;background:orange;color:white;border-radius:10px;}  
    #lab{position:absolute;font-size:16px;top:10px;right:40px;color:white;background:rgba(0,0,0,0.1); 
z-index:1}
   
    body{
 -webkit-user-select: none;
 -khtml-user-select: none;
 -moz-user-select: none;
 -ms-user-select: none;
 user-select: none;
}
    
    
  </style>
<style>
.icrop-wrap{
    position:relative
}
.icrop-clip-canv,.icrop-preview-canv{
    display:block
}
.icrop-clip-canv,.icrop-bg{
    position:absolute;
    top:0;
    left:0
}
.icrop-bg{
    background:#000;
    opacity:.5;
    filter:alpha(opacity=50)
}
.icrop-clip-wrap{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    overflow:hidden
}
.icrop-clip-canv{
    position:absolute;
    top:0;
    left:0
}
.icrop-box{
    position:absolute;
    top:0;
    left:0;
    width:0;
    height:0;
    display:none;
    cursor:move;
    border:1px dashed #0cf;
    touch-action:none
}
.icrop-transition{
    transition:top .5s,left .5s,width .5s,height .5s
}
.notransition{
    -webkit-transition:none!important;
    -moz-transition:none!important;
    -o-transition:none!important;
    transition:none!important
}
.resize{
    position:absolute;
    z-index:3;
    width:17px;
    height:17px;
    background:#ccc;
    background:rgba(255,255,255,.6);
    border:1px solid #333;
    border-radius:2px
}
.N{
    top:-10px;
    left:-10px
}
.W{
    top:-10px;
    left:-10px
}
.S{
    left:-10px;
    bottom:-10px
}
.E{
    right:-10px;
    top:-10px
}
.N,.S{
    cursor:ns-resize
}
.E,.W{
    cursor:ew-resize
}
.NW,.SE{
    cursor:nw-resize
}
.NE,.SW{
    cursor:ne-resize
}
.NW,.NE{
    top:-10px
}
.SE,.SW{
    bottom:-10px
}
.NW,.SW{
    left:-10px
}
.NE,.SE{
    right:-10px
}
.wrapN,.wrapS{
    position:absolute;
    left:50%
}
.wrapE,.wrapW{
    position:absolute;
    top:50%
}
.wrapN{
    top:0
}
.wrapS{
    bottom:0
}
.wrapE{
    right:0
}
.wrapW{
    left:0
}

.file-input{
    position:absolute;
    right:0;
    top:0;
    font-family:helvetica,arial;
    font-size:118px;
    margin:0;
    padding:0;
    cursor:pointer;
    opacity:0
}
.file-button{
    position:relative;
    overflow:hidden;
    direction:ltr
}
.ibox{
    background:#fff;
    border:0px solid #ccc;
    padding:19px;
    border-radius:3px
}
.clearfix:after,.c-text:after{
    visibility:hidden;
    display:block;
    content:"";
    clear:both;
    height:0
}


.but{
    text-align:center;
    height:32px;
    font:16px/30px helvetica,arial;
    display:inline-block;
    cursor:pointer;
    padding:0 10px;
    text-decoration:none;
    border-radius:3px;
    box-sizing:border-box;
    -moz-box-sizing:border-box;
    -webkit-box-sizing:border-box;
    user-select:none;
    -webkit-user-select:none;
    -moz-user-select:none;
    -ms-user-select:none
}
.but:hover{
    text-decoration:none;
    box-shadow:-1px 1px 1px rgba(0,0,0,.2);
    z-index:2
}
.but:active{
    box-shadow:none
}

.but.lrg{
    height:36px;
    line-height:34px;
    border-radius:4px
}
.but.l{
    color:#000000;
    fill:#000000;
    border:1px solid #ccc;
    background:#fff
}
.but.l:hover{
    border:1px solid #999
}

/* PAGE */

#ic-cropper-wrap .icrop-wrap{
  margin-top:20px
}

.ic-btns{
  margin:-5px
}

.ic-btns .but,#ic-auto-crop-padding{
  float:left;
  margin:5px
}

#ic-auto-crop-btn{
  margin-right:-11px;
  border-radius:4px 0 0 4px;
  position:relative;
  z-index:1
}

#ic-auto-crop-padding{
  width:75px;
  height:36px;
  border-radius:0 4px 4px 0;
  padding-left:10px
}

#ic-rotate-btn svg{
  width:28px;
  height:28px;
  float:left;
  margin:3px 3px 3px -3px;
  color: white;
}

#ic-crop-btn-wrap{
  margin-top:20px;
  margin-bottom:20px;
}

#ic-download-wrap{
  margin-top:20px
}

#ic-download-btn{
  vertical-align:middle;
  margin-right:10px
}

#ic-download-wrap .select{
  height:34px;
  line-height:34px
}

#ic-download-wrap select{
  line-height:34px
}

#ic-info{
  vertical-align:middle;
  margin-left:10px
}

.ic-hidden{
  display:none
}
input,button{padding:10px;}
#box{display:none}
</style>
</head>
<body>
<div id="cpass" style="margin-top:20px">
<center>
 
<input id="pass" type="password" style="width:200px" required placeholder="Mausskan Password"><button onclick="go()" style="width:60px">OK</button><br>
<span id="hsl"></span>
</center>
</div>
<div class="box" id="box">
  <h2>Daftar Data</h2><button style="padding:3px" onclick="loadAset()">Refresh</button>

  <select id="nkode">
   <option value="PIL">Silahkan Pilih</option>
    <option value="P">Siswa SK Pemberian</option>
    <option value="N">Siswa Nominasi</option>
    
  </select>

 <div id="info">
 </div><input
  type="text"
  id="cariNama"
  placeholder="Cari berdasarkan nama..."
  
  style="margin-bottom:10px; padding:5px; width:250px;"
>


<table id="tabelAset" border="0" cellpadding="8" cellspacing="0" width="100%">
  <thead>
    <tr>
      <th>No</th>
      <th>ID</th>
      <th>Nama</th>
	  <th>NISN</th>
	  <th>KLS</th>
	  <th>JK</th>
	   <th>Nominal</th>
	   <th>Rekening</th>
	   <th>Foto1</th>
	     <th>Foto2</th>
		 <th>Ket</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>


  <ul id="list">
    <li class="loading"></li>
  </ul>
</div>
 
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="tutupModal()">√ó</span>
    <h3>Detail Data</h3>
    <p><b>ID:</b> <span id="m_id"></span></p>
    
    <p><b>Nama:</b> <span id="m_nama"></span></p>
	 
     
 
  <label id='lab'></label>
<video id='video' style='display:none'></video>
<div style='margin:0px;padding:0px'><center>
<video id='vid1' style='width:100%;display:block'></video>
</center></div>

<button id='tdw' style='font-size:20px;padding:10px;width:100%;display:none'>Ambil foto</button>
 
  
<button id='cs' display:none' onclick='stop(0)' >Tutup Kamera</button>
 
<div class='no-items section' id='expert'></div>
<button id='coba' style='display:none'>coba</button>
<div class='w3-modal cropper'>
<div class='w3-modal-content'>
<div class='w3-container w3-white'>
<div class='ibox' id='ic-main'>
<div class='ic-btns clearfix' style='display:none'>
<div class='l but lrg file-button w3-button w3-blue' id='ic-upload-btn'>
<span id='ic-upload-btn-label' style='font-family: inherit;font-size: inherit;'>Upload Image</span>
<input class='file-input' type='file'/>
</div>
</div>
<div id='ic-cropper-wrap'><div class='icrop-wrap'><canvas class='icrop-preview-canv' height='800' style='width: 125.418px; height: 227px;' width='442'></canvas><div class='icrop-bg' style='height: 227px; width: 125px;'></div><div class='icrop-box' style='position: absolute; display: block; left: -1px; top: -1px; width: 125px; height: 227px;'><div class='icrop-clip-wrap'>
<canvas class='icrop-clip-canv' height='800' style='width: 125.418px; height: 227px; left: 0px; top: 0px;' width='442'></canvas></div><div class='wrapN'><div class='resize N' data-dir='N'></div></div><div class='wrapE'><div class='resize E' data-dir='E'></div></div><div class='wrapS'><div class='resize S' data-dir='S'></div></div><div class='wrapW'><div class='resize W' data-dir='W'></div></div><div class='resize NW' data-dir='NW'></div><div class='resize NE' data-dir='NE'></div><div class='resize SE' data-dir='SE'></div><div class='resize SW' data-dir='SW'></div></div></div></div>
<div class='ic-crop-btn-wrap'><br/>
<div class='l but lrg w3-button w3-grey' id='ic-rotate-btn'>
<svg enable-background='new 0 0 50 50' height='50px' viewBox='0 0 50 50' width='50px' x='0px' xml:space='preserve' y='0px'>
<path d='M41.038,24.1l-7.152,9.342L26.734,24.1H31.4c-0.452-4.397-4.179-7.842-8.696-7.842c-4.82,0-8.742,3.922-8.742,8.742 s3.922,8.742,8.742,8.742c1.381,0,2.5,1.119,2.5,2.5s-1.119,2.5-2.5,2.5c-7.576,0-13.742-6.165-13.742-13.742 s6.166-13.742,13.742-13.742c7.274,0,13.23,5.686,13.697,12.842H41.038z'></path>
</svg>
                    Rotate
                </div>
<div class='l but lrg w3-button w3-grey' id='ic-flip-btn'>Flip</div>
<a class='l but lrg w3-button w3-grey' id='ic-crop-btn'>Crop</a>
</div>
<div class='ic-hidden ic-result-wrap' id='ic-result-wrap' style='margin-top: 20px;display:none'>
<div class='result-container' style='position: relative;width: fit-content;block-size: fit-content;padding: 0px;z-index: 1;'><div class='theresult' style='position: relative;width: fit-content;block-size: block;padding: 0px;margin: 0px;'></div></div>
</div>
<div class='ic-hidden ic-download-wrap' id='ic-download-wrap' style='display:none'>
<div class='select'>
<select class='w3-select' id='ic-download-type' style='width: 100px; display:inline-block;'>
<option value='image/jpeg'>jpeg</option>
<option value='image/png'>png</option>
</select>
<a class='l but lrg w3-button w3-grey' id='ic-download-btn'>Download</a>
</div>
<hr/>
                Size: <span id='ic-info'>442w X 800h (x:0, y:0)</span>
</div>
</div>
<br/>
</div>
</div>
</div>
<button onclick="simpket(kodeaset)">Update Ket</button><br>
<span id="status"></span>
<progress id="progress" value="0" max="100"></progress>
   </div>
</div>
<script>
let GITHUB_TOKEN = "reyh";
const google = {
  script: {
    run: {
      _success: function () {},
      _failure: function () {},

      withSuccessHandler(fn) {
        this._success = fn;
        return this;
      },

      withFailureHandler(fn) {
        this._failure = fn;
        return this;
      },

      token(pass,cari) {
        fetch("https://script.google.com/macros/s/AKfycbwjuXY-0KMjFE03QnMUFwkK3eCRQEA_VuQPkPtirKR2XHQs2vTiYER7yj5Ur6CErGcs/exec", {
          method: "POST",
          body: new URLSearchParams({
            pass: pass,
            cari: cari
          }) // ‚¨ÖÔ∏è KUNCI
        })
        .then(res => res.text())          // ‚¨ÖÔ∏è sesuai GAS Anda
        .then(text => this._success(text))
        .catch(err => this._failure(err));
      }
    }
  }
};


function go(){
                google.script.run
                .withSuccessHandler(function(data){
				if(data=="salah"){document.getElementById("hsl").innerText="Password Salah";
				setTimeout(()=>{document.getElementById("hsl").innerText=''},2000)
				return}
				 
				document.getElementById("box").style.display="block"
				document.getElementById("cpass").style.display="none"
				document.getElementById("pass").value='';
				GITHUB_TOKEN=data;
				return;
				})
                .withFailureHandler(function(data){
				document.getElementById("hsl").innerText="Error Jaringan";
				setTimeout(()=>{document.getElementById("hsl").innerText=''},2000)
				document.getElementById("kont").style.display="none"
				document.getElementById("cpass").style.display="block"
				
				})
                .token(document.getElementById("pass").value,'token');	
                 			
                }
</script>
<script>
 let apastart=0;
 let kodeaset=''
const BASE_URL = "https://script.google.com/macros/s/AKfycbwjuXY-0KMjFE03QnMUFwkK3eCRQEA_VuQPkPtirKR2XHQs2vTiYER7yj5Ur6CErGcs/exec";

document.getElementById("nkode").addEventListener("change", loadAset);
//loadAset();
function loadAset(){
  const kode = document.getElementById("nkode").value;
  const list = document.getElementById("list");
  const info = document.getElementById("info");
  const tbody = document.querySelector("#tabelAset tbody");
  const li = document.querySelector(".loading");
  tbody.innerHTML = "";
li.textContent = "‚è≥ Memuat data ."
  
  info.textContent = "";
  
  let dots = 1;
  
  const loadingInterval = setInterval(() => {
  
  if (!li) return; // jaga-jaga kalau sudah dihapus

  li.textContent = "‚è≥ Memuat data" + " . ".repeat(dots);
  dots = dots >= 3 ? 1 : dots + 1;
}, 500);

  fetch(BASE_URL, {
  method: "POST",
  body: new URLSearchParams({
    pass: '123',
    cari: 'pip',
    nkode: kode
  })
})
.then(res => res.text())
.then(data => {
  clearInterval(loadingInterval)
 // list.innerHTML = ``;
  li.textContent='';
  const data1 = JSON.parse(data);
 
  if (!data1 || data1.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="11" style="text-align:center">Data tidak ditemukan</td>
      </tr>`;
    return;
  }

  document.getElementById("info").textContent =
    `Jumlah data: ${data1.length}`;

  const frag = document.createDocumentFragment();

  data1.forEach((item, index) => {
    const tr = document.createElement("tr");
	const fotoCell = item.foto1
  ? `<td>
  <img class="lazy-img"
     data-src="${item.foto1}"
     src="placeholder.webp"
     data-loaded="0"
     loading="lazy"
     style="max-width:80px">   
     </td>`
  : `<td></td>`;
  
  const fotoCell1 = item.foto2
  ? `<td>
       <img class="lazy-img"
     data-src="${item.foto2}"
     src="placeholder.webp"
     data-loaded="0"
     loading="lazy"
     style="max-width:80px">

     </td>`
  : `<td></td>`;
let akt= (item.aktifasi==1) ? `<td>‚úÖ </td>` : `<td> </td>`
    tr.innerHTML = `
      <td>${index + 1}</td>
	   <td>${item.id}</td>
      <td>${item.nama}</td>
      <td>${item.nisn}</td>
	  <td style='text-align:center' >${item.kelas}</td>
	  <td>${item.jk}</td>
      <td style='text-align:center'>${item.nominal}</td>
	  <td>${item.rek}</td>
	   ${fotoCell}
	    ${fotoCell1}
	   ${akt}
    `;
	// üëá SIMPAN DATA DI BARIS
    tr.dataset.id = item.id;
     
    tr.dataset.nama = item.nama;
	 

    // üëá EVENT KLIK BARIS
  tr.addEventListener("click", (e) => {
  const td = e.target.closest("td");
  if (!td) return;

  /* ===== KLIK FOTO ===== */
  if (td.cellIndex === 8 || td.cellIndex === 9) { // sesuaikan index foto
   e.preventDefault();
   e.stopPropagation();

    const img = e.target.closest("img");
	 
   if (!img) return;

 const url = img.dataset.src || img.src;
    const nama = tr.children[2]?.innerText.trim() || "foto";

    downloadGambar(url, nama + ".jpg");
    return;
  }

  /* ===== KLIK NAMA ===== */
  if (td.cellIndex === 2) {
    bukaModal(tr);

    if (apastart == 0) {
      start();
      apastart = 1;
    } else {
      stop(0);
    }
  }
});

    frag.appendChild(tr);
	 
		

  });

  tbody.appendChild(frag);
   initLazyLoad()
})
.catch(err => {

clearInterval(loadingInterval)
li.textContent='';
  document.querySelector("#tabelAset tbody").innerHTML = `
    <tr>
      <td colspan="11" style="text-align:center">‚ùå Gagal memuat data</td>
    </tr>`;
  console.error(err);
});


}

// load pertama
 function downloadGambar(url,fnama) {
  fetch(url)
    .then(res => {
      if (!res.ok) throw new Error("Gagal fetch");
      return res.blob();
    })
    .then(blob => {
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = fnama;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(a.href);
    })
    .catch(err => console.error(err));
}


  function initLazyLoad() {
  const imgs = document.querySelectorAll(".lazy-img");

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      const img = e.target;

      // üëÄ MASUK VIEWPORT
      if (e.isIntersecting) {
        if (img.dataset.loaded !== "1") {
          img.src = img.dataset.src;
          img.dataset.loaded = "1";
		  observer.unobserve(img);
        }
      }
    });
  }, {
    rootMargin: "300px"
  });

  imgs.forEach(img => observer.observe(img));
}






</script>
<script>
function bukaModal(tr){
document.getElementById("status").innerText=""
  document.getElementById("progress").value=0;
 document.body.style.overflow="hidden";
 kodeaset=tr.dataset.id
  document.getElementById("m_id").textContent = tr.dataset.id;
  
  document.getElementById("m_nama").textContent = tr.dataset.nama;
   

  
  PATH = "data/foto_" + Date.now() + ".jpg";
 

  document.getElementById("modal").style.display = "block";
}

function tutupModal(){
document.body.style.overflow="scroll";
  document.getElementById("modal").style.display = "none";
   stop(0)
}
</script>

<script>
      var gambar='';
      var myurl='';
      var canvas;
 var namafile='Fotoku'; 
 var gstream;
 const tdw=document.querySelector('#tdw');     
 const lab=document.querySelector('#lab');     
 const cs=document.querySelector('#cs');     
 const vid = document.querySelector('#video');
   const vid2=document.querySelector("#vid1");
      // const hsl=document.querySelector("#hsl");
function getValue() {
    var selectElement = document.getElementById("pil");
    var selectedValue = selectElement.value;
    namafile = selectedValue;
     
}
 
  //width:1280 height:720    
  //width:1280,height:820 good    
      //start();
   function start(){   
    //  cs.style.display='none'
 navigator.mediaDevices.getUserMedia({audio:false,video: true, video:{facingMode: 'environment',width:600,height:384}}) // camera depan: user : environment
 .then(stream => {
 vid.srcObject = stream;
   vid2.srcObject=stream;
     // cs.style.display='none'
      tdw.style.display='none';
   gstream=stream;
   // don't use createObjectURL(MediaStream)
 return vid.play(),vid2.play()
   // returns a Promise
 })
 .then(()=>{ // enable the button
 const btn = document.querySelector('#vid1');
 btn.disabled = false;
 btn.onclick = e => {
 takeASnap()
 .then(download);
 };
 })
 .catch(e=>console.log('please use the fiddle instead'));
      
 
 function takeASnap(){
 canvas = document.createElement('canvas'); // create a canvas
 const ctx = canvas.getContext('2d'); // get its context
   
   

 canvas.width =vid.videoWidth;
 canvas.height =vid.videoHeight;
 ctx.drawImage(vid,0,0); // the video
 return new Promise((res, rej)=>{
 canvas.toBlob(res, 'image/jpeg'); // request a Blob from the canvas
 });
     
 }
      
   }   
      
 function download(blob){
   canvas=null;   

 var uk=(blob.size/1000).toFixed(2);
      lab.innerHTML=uk+' KB';
   // if (nama(0)==0){return false}  
// let a = document.createElement('a'); 
myurl = URL.createObjectURL(blob)
      gambar=myurl;
      gocrop();
	  const box = document.getElementById("modal");
	  setTimeout(() => {
  box.scrollTop = box.scrollHeight;
}, 200);
 
   //   hsl.innerHTML="<img onclick='download2()' src='"+myurl+"' style='width:170px'/>";
// a.download = namafile+'.jpg';
 //a.appendChild('yyyy')
  //    document.body.appendChild(a);

// a.click();
      

    //  document.body.removeChild(a)
      
     
 }
   
 function download2(){
  
  
let a = document.createElement('a'); 
 a.href = myurl;
     
a.download = namafile+'.jpg';
// a.appendChild('yyyy')
      document.body.appendChild(a);

 a.click();
      

      document.body.removeChild(a)
      
     
 }
     
      
      
      
      
      
  function stop(n){

gstream.getVideoTracks().forEach(function (track) {
      if (track.readyState=='live'){
      
track.stop();
   cs.innerHTML='Buka Kamera'  
      tdw.style.display='none';
     lab.innerHTML='';
      }
      else {
   if (track.readyState=='ended'){
      start()
      cs.innerHTML='Tutup Camera'
      lab.innerHTML='';
    tdw.style.display='none';  
      }}

   
      
   
}); }
  function nama(n){var b=prompt('Nama File: ',namafile);
      
    
if(b==null || b==""){return 0}
 else{     
namafile=b; return 1}}
   
 </script>
 <script src='https://smpn9.github.io/crop/events.js'></script>
<script src='https://smpn9.github.io/crop/cropper.js'></script>
<script src='rendered3.js'></script>
<script>
    var bb=document.getElementById("coba");
   function gocrop(){
        bb.click() 
       
    }
    
    </script>
<script>
/* ================== KONFIGURASI ================== */

const OWNER = "smpn9sinjai";
const REPO = "pip";
let PATH = "data/foto_" + Date.now() + ".png";
const BRANCH = "main";
/* ================================================ */

 



/* === KODE KONVERSI BASE64 ‚Üí BLOB (SESUAI ANDA) === */
function base64ToBlob(e) {
  const byteString = atob(e.split(",")[1]);
  const mime = e.split(",")[0].match(/:(.*?);/)[1];
  const ab = new ArrayBuffer(byteString.length);
  const ia = new Uint8Array(ab);

  for (let i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }

  return new Blob([ab], { type: mime });
}

/* ================================================= */

function uploadGithub(bs){
  
if (!base64Valid(bs)) {
    alert("‚ùå Gambar belum siap / Base64 tidak valid");
    return;
  }
  const status = document.getElementById("status");
  const progress = document.getElementById("progress");
status.innerText="Prog 1 / 2"
progress.value=0;
  const blob = base64ToBlob(bs) ;

  const reader = new FileReader();
  reader.onload = () => {
 
    const contentBase64 = reader.result.split(",")[1];

    const payload = JSON.stringify({
      message: "Upload via HTML + XMLHttpRequest",
      content: contentBase64,
      branch: BRANCH
    });

    const xhr = new XMLHttpRequest();
    xhr.open("PUT",
      `https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}`,
      true
    );

    xhr.setRequestHeader("Authorization", "token " + GITHUB_TOKEN);
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.upload.onprogress = e => {
      if (e.lengthComputable) {
        const percent = Math.round((e.loaded / e.total) * 100);
        progress.value = percent;
        status.innerText = "Uploading: " + percent + "%";
      }
    };

    xhr.onload = () => {
      if (xhr.status === 201) {
        status.innerText = "‚úÖ Upload GIT berhasil!";
		simpaset(kodeaset)
      } else {
	    document.getElementById("progress").value=50;
        status.innerText = "‚ùå Gagal upload GIT"
      }
    };

    xhr.onerror = () => {
	  document.getElementById("progress").value=0;
      status.innerText = "‚ùå Error koneksi";
    };

    xhr.send(payload);
  };

  reader.readAsDataURL(blob);
}

function base64Valid(b64) {
  return (
    typeof b64 === "string" &&
    b64.startsWith("data:image/") &&
    b64.includes(";base64,")
  );
}

function simpaset(kode1){
   document.getElementById("status").innerText="Prog 2 / 2"
  document.getElementById("progress").value=0;

   

  fetch(BASE_URL, {
  method: "POST",
  body: new URLSearchParams({
    pass: PATH,
    cari: 'simppip',
    nkode: kode1
  })
})
.then(res => res.text())
.then(data => {
 if(data=="OK"){
  document.getElementById("status").innerText="‚úÖ Upload GS berhasil!"
  PATH = "data/foto_" + Date.now() + ".jpg";
  document.getElementById("progress").value=100;
 }
 else{
 document.getElementById("status").innerText="‚ùå Gagal upload GS"
  document.getElementById("progress").value=50;
 }
  
})
.catch(err => {
  document.getElementById("status").innerText="‚ùå Error"
});


}

function simpket(kode1){
   document.getElementById("status").innerText="Prog 1 / 1"
  document.getElementById("progress").value=0;

   

  fetch(BASE_URL, {
  method: "POST",
  body: new URLSearchParams({
    pass: PATH,
    cari: 'simppipket',
    nkode: kode1
  })
})
.then(res => res.text())
.then(data => {
 if(data=="OK"){
  document.getElementById("status").innerText="‚úÖ Upload GS berhasil!"
  document.getElementById("progress").value=100;
 }
 else{
 document.getElementById("status").innerText="‚ùå Gagal upload GS"
  document.getElementById("progress").value=50;
 }
  
})
.catch(err => {
  document.getElementById("status").innerText="‚ùå Error"
});

}

document.getElementById("cariNama").addEventListener("input", function () {
  const filter = this.value.toLowerCase();
  document.querySelectorAll("#tabelAset tbody tr").forEach(tr => {
    const nama = tr.children[2].innerText.toLowerCase();
    tr.style.display = nama.includes(filter) ? "" : "none";
  });
});
</script>
</body>
</html>



