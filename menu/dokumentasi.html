<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dokumentasi Kegiatan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">

<style>
body{
  font-family:Inter;
  background:#f0f2f5;
  padding:20px
}
.container{
  max-width:900px;
  margin:auto
}
.bulan-group{
  margin-bottom:30px
}
.bulan-title{
  font-size:20px;
  font-weight:700;
  margin-bottom:15px;
  color:#1b4f72
}
.card{
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 16px rgba(0,0,0,.08);
  margin-bottom:15px
}
.card h4{
  margin:0 0 8px;
  color:#2e86de
}
.card small{
  color:#666
}
.lampiran{
  margin-top:10px;
  display:flex;
  flex-wrap:wrap
}
.lampiran img{
  width:310px;
  height:auto;
  border-radius:8px;
  margin:4px;
  box-shadow:0 2px 6px rgba(0,0,0,.2);
  cursor:pointer;
  background:#eee
}
 @media all and (min-width: 768px) {
  .lampiran img{
  width:260px;
  height:auto;
}
}


  
.error{
  color:red;
  font-weight:bold;
  text-align:center
}
</style>
</head>

<body>
<div class="container" id="konten">
  <h2>üì∏ Dokumentasi Kegiatan</h2>
  <p>Memuat data...</p>
</div>

<script>
const baseUrl = 'https://smpn9sinjai.sch.id/dokumentasi/';
const fileUrl = baseUrl + 'data/surat.json?t=' + Date.now();

const xhr = new XMLHttpRequest();
xhr.open('GET', fileUrl, true);

xhr.onreadystatechange = function () {
  if (xhr.readyState === 4) {
    const konten = document.getElementById('konten');

    if (xhr.status === 200) {
      try {
        let data = JSON.parse(xhr.responseText);

        // Sort terbaru ‚Üí terlama
        data.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

        konten.innerHTML = '<h2>üì∏ Dokumentasi Kegiatan</h2>';
        let currentGroup = '';

        data.forEach(item => {
          const tgl = new Date(item.tanggal);
          const key = tgl.toLocaleString('id-ID', { month: 'long', year: 'numeric' });

          if (key !== currentGroup) {
            currentGroup = key;
            const groupDiv = document.createElement('div');
            groupDiv.className = 'bulan-group';
            groupDiv.innerHTML = `<div class="bulan-title">${key}</div>`;
            konten.appendChild(groupDiv);
          }

          const group = konten.lastElementChild;
          const card = document.createElement('div');
          card.className = 'card';

          let lampiranHTML = '';
          if (item.lampiran && Array.isArray(item.lampiran)) {
            lampiranHTML = item.lampiran.map((p,i)=>`
              <img
                class="lazy-img"
                data-src="${baseUrl + p}"
                data-loaded="0"
                alt="Dokumentasi ${i+1}"
                onclick="window.open('${baseUrl + p}','_blank')"
              >
            `).join('');
          }

          card.innerHTML = `
            <h4>${item.kegiatan || item.perihal}</h4>
            <small>üìÖ ${item.tanggal}</small>
            <div class="lampiran">${lampiranHTML}</div>
          `;

          group.appendChild(card);
        });

        initLazyLoad(); // ‚¨ÖÔ∏è aktifkan observer

      } catch (e) {
        konten.innerHTML = `<p class="error">‚ùå Gagal parsing JSON</p>`;
      }
    } else {
      konten.innerHTML = `<p class="error">‚ùå Gagal mengambil data (Status ${xhr.status})</p>`;
    }
  }
};
xhr.send();

/* =======================
   LAZY LOAD OBSERVER
======================= */
function initLazyLoad(){
  const imgs = document.querySelectorAll(".lazy-img");

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      const img = e.target;

      if (e.isIntersecting) {
        if (!img.src) {
          img.src = img.dataset.src;
          img.dataset.loaded = "1";
        }
      } else {
        if (img.dataset.loaded === "1" &&
            Math.abs(e.boundingClientRect.top) > window.innerHeight * 2) {
          img.removeAttribute("src");
          img.dataset.loaded = "0";
        }
      }
    });
  }, { rootMargin: "300px" });

  imgs.forEach(img => observer.observe(img));
}
</script>
</body>
</html>



